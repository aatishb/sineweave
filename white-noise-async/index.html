<!doctype html>
<html>
<body>
<div>
<canvas id='scope' width=400 height=200></canvas>
<canvas id='spectrum' width=400 height=200></canvas>
</div>
</body>
<a href = "loop.js">View Source</a>
<script>

let analyser;

const audio = new AudioContext();

async function loadModules() {
  // Load multiple modules sequentially.
  await audio.audioWorklet.addModule('loop.js');
  return await audio.audioWorklet.addModule('audio-processor.js');
}

loadModules().then(() => {
  const workletNode = new AudioWorkletNode(audio, 'audio-processor');
  workletNode.connect(audio.destination);

  analyser = audio.createAnalyser();
  workletNode.connect(analyser);
	draw();
});

</script>
<script src = "analyser.js"></script>
</html>