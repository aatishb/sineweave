---
layout: livecode
title: Steam Whistle (WaveGuide)
category: instrument
blurb:
---
let waveGuide;
let freq = 500;
let feedback = 1.67, breath = 0.67, cutoff = 0.3;
let lpfilter, dcfilter;

function setup() {
  slider('feedback', 0, 2, 0.01);
  slider('breath', 0, 1, 0.01);
  slider('cutoff', 0, 1, 0.01);
  let waveGuideLength = Math.round(sampleRate / freq - 0.5);
  waveGuide = new WaveGuide(waveGuideLength);
  lpfilter = lowPass(cutoff);
  dcfilter = dcBlocker(0.005);
}

function loop() {

  lpfilter.set(cutoff);

  waveGuide
    .delay(numSamples)
    .update(mult(feedback))
    .update(add(noiseWave().mult(breath)))
    .update(e => Math.tanh(e))
    .apply(lpfilter)
    .apply(dcfilter);

  return waveGuide.get().mult(0.1);
}
