---
layout: livecode
title: Steam Whistle
category: waveguide
blurb:
---
let output, waveTable, noise;
let freq = 500;
let feedback = 1.67, breath = 0.67, cutoff = 0.3;
let lpfilter = new lowPass(cutoff);
let dcfilter = new dcBlocker(0.005);

function setup() {
  slider('feedback', 0, 2, 0.01);
  slider('breath', 0, 1, 0.01);
  slider('cutoff', 0, 1, 0.01);
  let waveTableLength = Math.round(sampleRate / freq - 0.5);
  waveTable = new WaveTable(waveTableLength);
}

function loop() {

  noise = time.map(whiteNoise).mult(breath);
  waveTable.update(waveTable.get().mult(feedback).add(noise));

  waveTable.delay(128);
  lpfilter.set(cutoff);

  output = waveTable.get()
    .map(e => Math.tanh(e))
    .applyFilter(dcfilter)
    .applyFilter(lpfilter);
  waveTable.update(output);

  return output.mult(0.1);
}
